
<!DOCTYPE html>

<html lang="Python">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Examples &#8212; RlassoModels  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/js/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Documentation" href="api_reference.html" />
    <link rel="prev" title="Install" href="install.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Examples">
<h1>Examples<a class="headerlink" href="#Examples" title="Permalink to this headline">¶</a></h1>
<p>RlassoModels includes four estimators <code class="docutils literal notranslate"><span class="pre">Rlasso</span></code>, <code class="docutils literal notranslate"><span class="pre">RlassoLogit</span></code>, <code class="docutils literal notranslate"><span class="pre">RlassoPDS</span></code> and <code class="docutils literal notranslate"><span class="pre">RlassoIV</span></code>. The dataset from Acemoglu, Johnson and Robinson (2001) will be used as a running example, to highlight the different models. This is dataset is also used for various examples in the stata packages <a class="reference external" href="https://statalasso.github.io/docs/lassopack/help/rlasso_help/">lassopack</a> and <a class="reference external" href="https://statalasso.github.io/docs/pdslasso/ivlasso_help/">pdslasso</a> by Ahrens, Hansen &amp; Schaffer (2018, 2020) on which
RlassoModels is largely based. See also the R version <a class="reference external" href="https://arxiv.org/abs/1603.01700">HDM</a> (Chernozkukov, Hansen &amp; Spindler, 2016).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># imports</span>
<span class="kn">from</span> <span class="nn">rlassomodels</span> <span class="kn">import</span> <span class="n">Rlasso</span><span class="p">,</span> <span class="n">RlassoPDS</span><span class="p">,</span> <span class="n">RlassoIV</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span><span class="p">,</span> <span class="n">LassoLarsIC</span><span class="p">,</span> <span class="n">LassoLarsCV</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="kn">import</span> <span class="n">assert_equal</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get data and select y and X</span>
<span class="n">ajr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s2">&quot;https://statalasso.github.io/dta/AJR.dta&quot;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">ajr_df</span><span class="p">[[</span><span class="s2">&quot;lat_abst&quot;</span><span class="p">,</span> <span class="s2">&quot;edes1975&quot;</span><span class="p">,</span> <span class="s2">&quot;avelf&quot;</span><span class="p">,</span> <span class="s1">&#39;temp1&#39;</span><span class="p">,</span> <span class="s1">&#39;temp2&#39;</span><span class="p">,</span> <span class="s1">&#39;temp3&#39;</span><span class="p">,</span> <span class="s1">&#39;temp4&#39;</span><span class="p">,</span> <span class="s1">&#39;temp5&#39;</span><span class="p">,</span> <span class="s1">&#39;humid1&#39;</span><span class="p">,</span>
            <span class="s2">&quot;humid2&quot;</span><span class="p">,</span> <span class="s1">&#39;humid3&#39;</span><span class="p">,</span> <span class="s1">&#39;humid4&#39;</span> <span class="p">,</span><span class="s2">&quot;oilres&quot;</span><span class="p">,</span><span class="s2">&quot;steplow&quot;</span><span class="p">,</span> <span class="s2">&quot;deslow&quot;</span><span class="p">,</span> <span class="s2">&quot;stepmid&quot;</span><span class="p">,</span><span class="s2">&quot;desmid&quot;</span><span class="p">,</span> <span class="s2">&quot;drystep&quot;</span><span class="p">,</span>
            <span class="s2">&quot;drywint&quot;</span><span class="p">,</span> <span class="s2">&quot;landlock&quot;</span><span class="p">,</span> <span class="s2">&quot;goldm&quot;</span><span class="p">,</span> <span class="s2">&quot;iron&quot;</span><span class="p">,</span> <span class="s2">&quot;silv&quot;</span><span class="p">,</span> <span class="s2">&quot;zinc&quot;</span><span class="p">]]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">ajr_df</span><span class="p">[</span><span class="s2">&quot;logpgp95&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dimensions: </span><span class="si">{</span><span class="n">ajr_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ajr_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dimensions: (64, 36)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>shortnam</th>
      <th>logpgp95</th>
      <th>avexpr</th>
      <th>lat_abst</th>
      <th>logem4</th>
      <th>edes1975</th>
      <th>avelf</th>
      <th>temp1</th>
      <th>temp2</th>
      <th>temp3</th>
      <th>...</th>
      <th>zinc</th>
      <th>oilres</th>
      <th>baseco</th>
      <th>_merge</th>
      <th>indtime</th>
      <th>euro1900</th>
      <th>democ1</th>
      <th>cons1</th>
      <th>democ00a</th>
      <th>cons00a</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AGO</td>
      <td>7.770645</td>
      <td>5.363636</td>
      <td>0.136667</td>
      <td>5.634789</td>
      <td>0.0</td>
      <td>0.772755</td>
      <td>26.0</td>
      <td>28.0</td>
      <td>37.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>146000.0</td>
      <td>1.0</td>
      <td>matched (3)</td>
      <td>20.0</td>
      <td>8.000000</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ARG</td>
      <td>9.133459</td>
      <td>6.386364</td>
      <td>0.377778</td>
      <td>4.232656</td>
      <td>90.0</td>
      <td>0.176932</td>
      <td>17.0</td>
      <td>25.0</td>
      <td>40.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>46900.0</td>
      <td>1.0</td>
      <td>matched (3)</td>
      <td>170.0</td>
      <td>60.000004</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AUS</td>
      <td>9.897972</td>
      <td>9.318182</td>
      <td>0.300000</td>
      <td>2.145931</td>
      <td>99.0</td>
      <td>0.112797</td>
      <td>17.0</td>
      <td>18.0</td>
      <td>43.0</td>
      <td>...</td>
      <td>12.0</td>
      <td>99100.0</td>
      <td>1.0</td>
      <td>matched (3)</td>
      <td>94.0</td>
      <td>98.000000</td>
      <td>10.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BFA</td>
      <td>6.845880</td>
      <td>4.454545</td>
      <td>0.144444</td>
      <td>5.634789</td>
      <td>0.0</td>
      <td>0.546718</td>
      <td>29.0</td>
      <td>38.0</td>
      <td>48.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>matched (3)</td>
      <td>35.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BGD</td>
      <td>6.877296</td>
      <td>5.136364</td>
      <td>0.266667</td>
      <td>4.268438</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>25.0</td>
      <td>29.0</td>
      <td>42.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>matched (3)</td>
      <td>23.0</td>
      <td>0.000000</td>
      <td>8.0</td>
      <td>7.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 36 columns</p>
</div></div>
</div>
<section id="Rlasso">
<h2>Rlasso<a class="headerlink" href="#Rlasso" title="Permalink to this headline">¶</a></h2>
<p>The class <code class="docutils literal notranslate"><span class="pre">Rlasso</span></code> is a <a class="reference external" href="https://scikit-learn.org/stable/">scikit-learn</a> compatible estimator that implements the lasso and square-root lasso with data-driven and theoretically justified penalty level (see: Belloni et al.,2011, 2013). It adopts the syntax where all hyperparameters are definied upon class instantiation and data, or data-dependent arguments, is passed to the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method. This for example means that it can be passed to a
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html">pipeline</a>. In adition, it is also possible to call <code class="docutils literal notranslate"><span class="pre">fit_formula()</span></code> which uses R-style model specification, made possible by the package <a class="reference external" href="https://patsy.readthedocs.io/en/latest/">patsy</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define model and fit</span>
<span class="n">rlasso</span> <span class="o">=</span> <span class="n">Rlasso</span><span class="p">(</span><span class="n">post</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sqrt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cov_type</span><span class="o">=</span><span class="s2">&quot;robust&quot;</span><span class="p">)</span>
<span class="n">res1</span> <span class="o">=</span> <span class="n">rlasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="c1"># fit same model but using formula</span>
<span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;logpgp95 ~ &quot;</span> <span class="o">+</span> <span class="s2">&quot; + &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">res2</span> <span class="o">=</span> <span class="n">rlasso</span><span class="o">.</span><span class="n">fit_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ajr_df</span><span class="p">)</span>

<span class="n">assert_equal</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">res2</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can compare the results of different <code class="docutils literal notranslate"><span class="pre">Rlasso</span></code> specifications to common alternatives for choosing <span class="math notranslate nohighlight">\(\lambda\)</span>, featured in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define models</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;rlasso&quot;</span><span class="p">:</span> <span class="n">Rlasso</span><span class="p">(</span><span class="n">post</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>  <span class="c1"># post-lasso is default</span>
          <span class="s2">&quot;sqrt-rlasso&quot;</span><span class="p">:</span> <span class="n">Rlasso</span><span class="p">(</span><span class="n">sqrt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
          <span class="s2">&quot;rlasso-post&quot;</span><span class="p">:</span> <span class="n">Rlasso</span><span class="p">(),</span>
          <span class="s2">&quot;AIC&quot;</span><span class="p">:</span> <span class="n">LassoLarsIC</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;aic&quot;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
          <span class="s2">&quot;BIC&quot;</span><span class="p">:</span> <span class="n">LassoLarsIC</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;bic&quot;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
          <span class="s2">&quot;CV&quot;</span><span class="p">:</span> <span class="n">LassoLarsCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
          <span class="p">}</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">tmp_res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tmp_res</span><span class="o">.</span><span class="n">intercept_</span><span class="p">]</span> <span class="o">+</span> <span class="n">tmp_res</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;intercept&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rlasso</th>
      <th>sqrt-rlasso</th>
      <th>rlasso-post</th>
      <th>AIC</th>
      <th>BIC</th>
      <th>CV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>intercept</th>
      <td>7.981</td>
      <td>7.952</td>
      <td>8.141</td>
      <td>7.039</td>
      <td>7.039</td>
      <td>7.580</td>
    </tr>
    <tr>
      <th>lat_abst</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>edes1975</th>
      <td>0.011</td>
      <td>0.009</td>
      <td>0.018</td>
      <td>0.021</td>
      <td>0.021</td>
      <td>0.015</td>
    </tr>
    <tr>
      <th>avelf</th>
      <td>-0.270</td>
      <td>-0.137</td>
      <td>-1.004</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-0.450</td>
    </tr>
    <tr>
      <th>temp1</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.165</td>
    </tr>
    <tr>
      <th>temp2</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-0.027</td>
    </tr>
    <tr>
      <th>temp3</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-0.062</td>
    </tr>
    <tr>
      <th>temp4</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-0.075</td>
    </tr>
    <tr>
      <th>temp5</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-0.007</td>
    </tr>
    <tr>
      <th>humid1</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.002</td>
    </tr>
    <tr>
      <th>humid2</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.003</td>
    </tr>
    <tr>
      <th>humid3</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.012</td>
      <td>0.012</td>
      <td>0.023</td>
    </tr>
    <tr>
      <th>humid4</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-0.018</td>
    </tr>
    <tr>
      <th>oilres</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>steplow</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-0.138</td>
    </tr>
    <tr>
      <th>deslow</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>stepmid</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>desmid</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>drystep</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>drywint</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>landlock</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>goldm</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.022</td>
    </tr>
    <tr>
      <th>iron</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.004</td>
    </tr>
    <tr>
      <th>silv</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.035</td>
    </tr>
    <tr>
      <th>zinc</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As can be seen, rlasso tends to produce sparse solutions compared to cross-validation and in this example, selecting other variables than both AIC and BIC. To get an insight into the performance of Rlasso, estimates can be compared to the oracle estimator of running OLS only on active components. As can be seen from the example below, post-rlasso, that is running OLS on the rlasso selected components, significantly outperforms all other models and achives near oracle performance. Looking at the
second plot, it is easy to see that this must be the case since rlasso almost always selects all the correct components.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sparse_dgf</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data-generating function following Belloni (2011).</span>
<span class="sd">    Taken from statsmodels tests:</span>
<span class="sd">    https://github.com/statsmodels/statsmodels/blob/c1e30d9534dbe56346e50517da4dacf023a4aad7</span>
<span class="sd">    /statsmodels/regression/tests/test_regression.py#L1311</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Based on the example in the Belloni paper</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">ii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">cx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
    <span class="n">cxr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">cx</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)),</span> <span class="n">cxr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">b</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">cx</span>



<span class="n">oracle_ratio</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="n">correct_selected</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<span class="n">n_sims</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;rlasso&quot;</span><span class="p">:</span><span class="n">Rlasso</span><span class="p">(</span><span class="n">post</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
          <span class="s2">&quot;post-rlasso&quot;</span><span class="p">:</span><span class="n">Rlasso</span><span class="p">(),</span>
          <span class="s2">&quot;AIC&quot;</span><span class="p">:</span> <span class="n">LassoLarsIC</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">noise_variance</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span><span class="c1"># needs sigma when p&gt;n</span>
          <span class="s2">&quot;BIC&quot;</span><span class="p">:</span> <span class="n">LassoLarsIC</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">noise_variance</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span><span class="c1"># needs sigma when p&gt;n</span>
          <span class="s2">&quot;CV&quot;</span><span class="p">:</span> <span class="n">LassoLarsCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
          <span class="p">}</span>

<span class="k">def</span> <span class="nf">oracle_sim</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sims</span><span class="p">):</span>
        <span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cx</span> <span class="o">=</span> <span class="n">sparse_dgf</span><span class="p">()</span>
        <span class="c1"># oracle estimator (OLS) on true support</span>
        <span class="n">X_oracle</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,:</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">oracle_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">oracle_est</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X_oracle</span><span class="o">.</span><span class="n">T</span><span class="nd">@X_oracle</span><span class="p">,</span> <span class="n">X_oracle</span><span class="o">.</span><span class="n">T</span><span class="nd">@y</span><span class="p">)</span>

        <span class="n">oracle_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">oracle_e</span> <span class="o">=</span> <span class="n">oracle_est</span> <span class="o">-</span> <span class="n">b</span>

        <span class="n">oracle_selected</span> <span class="o">=</span> <span class="n">oracle_est</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">oracle_e</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">oracle_e</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>


            <span class="c1"># get estimate</span>
            <span class="n">est</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">coef_</span> <span class="o">-</span> <span class="n">b</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">coef_</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="n">numer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">e</span><span class="p">)))</span>

            <span class="c1"># get ratio</span>
            <span class="n">oracle_ratio</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numer</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
            <span class="c1"># correctly selected components</span>
            <span class="n">correct_selected</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">oracle_selected</span> <span class="o">==</span> <span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

    <span class="c1"># plot results from simulations</span>
    <span class="c1"># oracle ratio</span>
    <span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s2">&quot;science&quot;</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">([</span><span class="n">oracle_ratio</span><span class="p">[</span><span class="s2">&quot;post-rlasso&quot;</span><span class="p">],</span> <span class="n">oracle_ratio</span><span class="p">[</span><span class="s2">&quot;rlasso&quot;</span><span class="p">],</span>
                        <span class="n">oracle_ratio</span><span class="p">[</span><span class="s2">&quot;AIC&quot;</span><span class="p">],</span> <span class="n">oracle_ratio</span><span class="p">[</span><span class="s2">&quot;BIC&quot;</span><span class="p">],</span>
                        <span class="n">oracle_ratio</span><span class="p">[</span><span class="s2">&quot;CV&quot;</span><span class="p">]])</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Empirical risk&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Model&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="s2">&quot;post-rlasso&quot;</span><span class="p">,</span> <span class="s2">&quot;rlasso&quot;</span><span class="p">,</span> <span class="s2">&quot;AIC&quot;</span><span class="p">,</span> <span class="s2">&quot;BIC&quot;</span><span class="p">,</span> <span class="s2">&quot;CV&quot;</span><span class="p">])</span>

        <span class="c1"># correctly selected components</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">([</span><span class="n">correct_selected</span><span class="p">[</span><span class="s2">&quot;post-rlasso&quot;</span><span class="p">],</span> <span class="n">correct_selected</span><span class="p">[</span><span class="s2">&quot;rlasso&quot;</span><span class="p">],</span>
                        <span class="n">correct_selected</span><span class="p">[</span><span class="s2">&quot;AIC&quot;</span><span class="p">],</span> <span class="n">correct_selected</span><span class="p">[</span><span class="s2">&quot;BIC&quot;</span><span class="p">],</span>
                        <span class="n">correct_selected</span><span class="p">[</span><span class="s2">&quot;CV&quot;</span><span class="p">]])</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Correctly selected components&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Model&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="s2">&quot;post-rlasso&quot;</span><span class="p">,</span> <span class="s2">&quot;rlasso&quot;</span><span class="p">,</span> <span class="s2">&quot;AIC&quot;</span><span class="p">,</span> <span class="s2">&quot;BIC&quot;</span><span class="p">,</span> <span class="s2">&quot;CV&quot;</span><span class="p">])</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">oracle_sim</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/examples_10_0.png" src="_images/examples_10_0.png" />
</div>
</div>
</section>
<section id="RlassoPDS">
<h2>RlassoPDS<a class="headerlink" href="#RlassoPDS" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">RlassoPDS</span></code> extends <code class="docutils literal notranslate"><span class="pre">Rlasso</span></code> to be used for causal inference in the following setting</p>
<div class="math notranslate nohighlight">
\[y_{i}=\alpha d_{i}+x_{i}^{\prime} \beta+\varepsilon_{i}\]</div>
<p>Where <span class="math notranslate nohighlight">\(d_{i}\)</span> is a scalar exogenous variable (can also be low-dimensional vector) for which we are interested in a obtaining a consistent estimate with valid standard errors and test statistics in the presence of high-dimensional <span class="math notranslate nohighlight">\(x_i\)</span>. This is possible using the <em>post-double-selection</em> (PDS) and <em>post-regularization</em> (CHS) methodology developed in a series of papers by Belloni et al. (2011, 2013, 2014) and Chernozhukov et al. (2015). By default both methods are used. Since the
purpose is inference and we’re interested in a limited amount of variables, the class is purposly no longer directly scikit-learn compatible. Instead, it uses the econometrics package <a class="reference external" href="https://bashtage.github.io/linearmodels/">linearmodels</a> in the final estimation stage to produce relevant outputs. This is shown below by considering a case where we want to perform inference for the variable <code class="docutils literal notranslate"><span class="pre">avexpr</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d_exog</span> <span class="o">=</span> <span class="n">ajr_df</span><span class="p">[</span><span class="s2">&quot;avexpr&quot;</span><span class="p">]</span>
<span class="n">rlasso_pds</span> <span class="o">=</span> <span class="n">RlassoPDS</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">D_exog</span><span class="o">=</span><span class="n">d_exog</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rlasso_pds</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Std. Errors and Test statistics valid for</span><span class="se">\n</span><span class="si">{</span><span class="n">rlasso_pds</span><span class="o">.</span><span class="n">valid_vars_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
              Model Comparison
============================================
                            PDS          CHS
--------------------------------------------
Dep. Variable          logpgp95     logpgp95
Estimator                   OLS          OLS
No. Observations             64           64
Cov. Est.            unadjusted   unadjusted
R-squared                0.7261       0.4199
Adj. R-squared           0.7075       0.4107
F-statistic              169.67       46.318
P-value (F-stat)         0.0000    1.005e-11
================== ============ ============
const                 5.7641***
                       (0.3774)
avexpr                0.3913***    0.3913***
                       (0.0562)     (0.0575)
edes1975              0.0091***
                       (0.0032)
zinc                    -0.0079
                       (0.0281)
avelf                -0.9975***
                       (0.2474)
--------------------------------------------

Std. Errors reported in parentheses
Std. Errors and Test statistics valid for
[&#39;avexpr&#39;]
</pre></div></div>
</div>
</section>
<section id="RlassoIV">
<h2>RlassoIV<a class="headerlink" href="#RlassoIV" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">RlassoIV</span></code> is used when one wants to use instruments in order to estimate low-dimensional endogenous variables in the setting</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
&amp;y_{i}=\alpha d_{i}+x_{i}^{\prime} \beta+\varepsilon_{i} \\
&amp;d_{i}=x_{i}^{\prime} \gamma+z_{i}^{\prime} \delta+u_{i}
\end{aligned}\end{split}\]</div>
<p>where both <span class="math notranslate nohighlight">\(z_i\)</span> and <span class="math notranslate nohighlight">\(x_i\)</span> are possibily high-dimensional. Note that we can still include exogonous variables. In the example below, we now treat <code class="docutils literal notranslate"><span class="pre">avexpr</span></code> as endogenous and specify that rigorous lasso should be used both to select instruments and controls.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get data and select y and X</span>
<span class="n">ajr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s2">&quot;https://statalasso.github.io/dta/AJR.dta&quot;</span><span class="p">)</span>

<span class="c1"># some instruments have NaN values</span>
<span class="n">ajr_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">ajr_df</span><span class="p">[[</span><span class="s2">&quot;edes1975&quot;</span><span class="p">,</span> <span class="s1">&#39;temp1&#39;</span><span class="p">,</span> <span class="s1">&#39;temp2&#39;</span><span class="p">,</span> <span class="s1">&#39;temp3&#39;</span><span class="p">,</span> <span class="s1">&#39;temp4&#39;</span><span class="p">,</span> <span class="s1">&#39;temp5&#39;</span><span class="p">,</span> <span class="s1">&#39;humid1&#39;</span><span class="p">,</span>
            <span class="s2">&quot;humid2&quot;</span><span class="p">,</span> <span class="s1">&#39;humid3&#39;</span><span class="p">,</span> <span class="s1">&#39;humid4&#39;</span> <span class="p">,</span><span class="s2">&quot;oilres&quot;</span><span class="p">,</span><span class="s2">&quot;steplow&quot;</span><span class="p">,</span> <span class="s2">&quot;deslow&quot;</span><span class="p">,</span> <span class="s2">&quot;stepmid&quot;</span><span class="p">,</span><span class="s2">&quot;desmid&quot;</span><span class="p">,</span> <span class="s2">&quot;drystep&quot;</span><span class="p">,</span>
            <span class="s2">&quot;drywint&quot;</span><span class="p">,</span> <span class="s2">&quot;landlock&quot;</span><span class="p">,</span> <span class="s2">&quot;goldm&quot;</span><span class="p">,</span> <span class="s2">&quot;iron&quot;</span><span class="p">,</span> <span class="s2">&quot;silv&quot;</span><span class="p">,</span> <span class="s2">&quot;zinc&quot;</span><span class="p">,</span> <span class="s2">&quot;lat_abst&quot;</span><span class="p">,</span> <span class="s2">&quot;avelf&quot;</span><span class="p">]]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">ajr_df</span><span class="p">[</span><span class="s2">&quot;logpgp95&quot;</span><span class="p">]</span>
<span class="c1"># subset instruments and endogenous var</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">ajr_df</span><span class="p">[[</span><span class="s2">&quot;logem4&quot;</span><span class="p">,</span> <span class="s2">&quot;euro1900&quot;</span><span class="p">,</span> <span class="s2">&quot;democ1&quot;</span><span class="p">,</span> <span class="s2">&quot;cons1&quot;</span><span class="p">,</span><span class="s2">&quot;democ00a&quot;</span><span class="p">,</span> <span class="s2">&quot;cons00a&quot;</span><span class="p">]]</span>
<span class="n">d_endog</span> <span class="o">=</span> <span class="n">ajr_df</span><span class="p">[</span><span class="s2">&quot;avexpr&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rlasso_iv</span> <span class="o">=</span> <span class="n">RlassoIV</span><span class="p">(</span><span class="n">select_X</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">select_Z</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">rlasso_iv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">D_exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D_endog</span><span class="o">=</span><span class="n">d_endog</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">Z</span><span class="p">)</span>

<span class="n">summary</span> <span class="o">=</span> <span class="n">rlasso_iv</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 Model Comparison
==================================================
                                PDS            CHS
--------------------------------------------------
Dep. Variable              logpgp95       logpgp95
Estimator                   IV-2SLS        IV-2SLS
No. Observations                 59             59
Cov. Est.                unadjusted     unadjusted
R-squared                    0.4334        -0.5831
Adj. R-squared               0.3915        -0.6104
F-statistic                  66.517         7.3846
P-value (F-stat)          1.232e-13         0.0066
==================     ============   ============
const                       3.1400*
                           (1.6429)
edes1975                     0.0025
                           (0.0070)
zinc                        -0.0658
                           (0.0523)
avelf                     -0.7468**
                           (0.3605)
avexpr                    0.8034***      0.9095***
                           (0.2687)       (0.3347)
==================== ============== ==============
Instruments                  logem4    instruments
                           euro1900
--------------------------------------------------

Std. Errors reported in parentheses
</pre></div></div>
</div>
<section id="References">
<h3>References<a class="headerlink" href="#References" title="Permalink to this headline">¶</a></h3>
<p>Acemoglu, D., Johnson, S., &amp; Robinson, J. A. (2001). The colonial origins of comparative development: An empirical investigation. American economic review, 91(5), 1369-1401.</p>
<p>Ahrens, A., Hansen, C. B., &amp; Schaffer, M. (2020). LASSOPACK: Stata module for lasso, square-root lasso, elastic net, ridge, adaptive lasso estimation and cross-validation.</p>
<p>Ahrens, A., Hansen, C.B., Schaffer, M.E. 2018. pdslasso and ivlasso: Programs for post-selection and post-regularization OLS or IV estimation and inference. <a class="reference external" href="http://ideas.repec.org/c/boc/bocode/s458459.html">http://ideas.repec.org/c/boc/bocode/s458459.html</a></p>
<p>Chernozhukov, V., Hansen, C., &amp; Spindler, M. (2016). hdm: High-dimensional metrics. arXiv preprint arXiv:1608.00354.</p>
<p>Chernozhukov, V., Hansen, C., &amp; Spindler, M. (2015). Post-selection and post-regularization inference in linear models with many controls and instruments. American Economic Review, 105(5), 486-90.</p>
<p>Belloni, A., Chen, D., Chernozhukov, V. and Hansen, C. (2012). Sparse models and methods for optimal instruments with an application to eminent domain. Econometrica 80 (6), 2369-2429.</p>
<p>Belloni, A., Chernozhukov, V. and Hansen C., (2013). Inference for high-dimensional sparse econometric models. In Advances in Economics and Econometrics: 10th World Congress, Vol. 3: Econometrics, Cambridge University Press: Cambridge, 245-295.</p>
<p>Belloni, A., Chernozhukov, V., Hansen, C. (2014). Inference on treatment effects after selection among high-dimensional controls. The Review of Economic Studies 81(2), 608-650..</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RlassoModels</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Rlasso">Rlasso</a></li>
<li class="toctree-l2"><a class="reference internal" href="#RlassoPDS">RlassoPDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#RlassoIV">RlassoIV</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#References">References</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">API Documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="install.html" title="previous chapter">Install</a></li>
      <li>Next: <a href="api_reference.html" title="next chapter">API Documentation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Matias Piqueras.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/examples.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>